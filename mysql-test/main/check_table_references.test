--source include/have_innodb.inc

create table t1 (x int primary key) engine=innodb;

create table t2 (x int, y int,
                 foreign key (x) references t1(x)) engine=innodb;

set statement foreign_key_checks = 0 for
  drop table t1;

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
  create table t1 (x int) engine=innodb;

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
  drop index x on t2;

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
  create unique index p on t1(x);

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
create index x on t2(x);

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
drop table t2;

check table t1 extended;
check table t2 extended;

--echo # ======================================================================

set statement foreign_key_checks = 0 for
create table t2 (x int, y int, key(x),
                 foreign key (x) references t1(x)) engine=innodb;


insert into t1 (x) values (1);

check table t1 extended;
check table t2 extended;

insert into t2 (x, y) values (1, 10);

check table t1 extended;
check table t2 extended;

set statement foreign_key_checks = 0 for
    insert into t2 (x, y) values (2, 20), (2, 20), (3, 30);

check table t1 extended;
check table t2 extended;

insert into t1 (x) values (2);

check table t1 extended;
check table t2 extended;


insert into t1 (x) values (3);

check table t1 extended;
check table t2 extended;

drop table t2, t1;



create table t1 (x int primary key, y int, z int,
                 key(x, z), unique(y)) engine=innodb;


insert into t1 (x, y, z) values (1, 10, 100);

create table t2 (x int, t text, y int, z int,
                 foreign key (x, y) references t1(x, z),
                 foreign key(z) references t1(y)) engine=innodb;

show create table t2;

set statement foreign_key_checks = 0 for
    insert into t2 (x, y, z, t) values (2, 2, 200, "two, two, 200"),
                                       (2, 22, 202, "two, twenty two, 202"),
                                       (3, 30, 300, "three, thirty, 300"),
                                       (0, 0, 10, NULL);

create table t3 (x int, t text, y int, z int
                #, foreign key (x) references t2(x)
                ) engine=innodb;

check table t1 extended;
check table t2 extended;
check table t3 extended;


drop table t3, t2, t1;
